<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Sermon Cue Assist — v5.2</title>
  <meta name="theme-color" content="#0b1020"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="icon" href="icons/icon-192.png" type="image/png"/>
  <link rel="apple-touch-icon" href="icons/icon-512.png"/>
  <style>
    :root{
      --bg:#0b1020; --panel:#0f1733; --ink:#e8eeff; --muted:#9fb0d9;
      --brand:#6aa6ff; --accent:#a176ff; --ok:#4cd97b; --warn:#ffb86b; --danger:#ff6a6a;
      --hi:#24335d; --hi2:#1a2240;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,Apple SD Gothic Neo,Noto Sans KR,Segoe UI,Roboto,sans-serif;
      color:var(--ink);
      background: radial-gradient(1000px 700px at 20% -10%, #15204a 0%, transparent 80%) , var(--bg);
    }
    header{
      position:sticky; top:0; z-index:10;
      background:linear-gradient(180deg, rgba(11,16,32,0.9), rgba(11,16,32,0.6));
      backdrop-filter: blur(6px);
      border-bottom:1px solid #1a2550;
    }
    .bar{
      max-width:1600px; margin:0 auto; padding:10px 16px; display:flex; gap:12px; align-items:center; justify-content:space-between;
    }
    .leftCtrls, .rightCtrls{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    h1{font-size:18px; margin:0; letter-spacing:0.3px}
    .pill{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px;
      background:var(--panel); border:1px solid #202a55; color:var(--ink); font-size:14px; cursor:pointer;
    }
    .pill:hover{ outline:1px solid #2a3b75 }
    .pill .dot{ width:10px; height:10px; border-radius:50% }
    .ok{ background:var(--ok) }
    .rec{ background:#ff5f5f; animation:pulse 1.2s infinite ease-in-out; }
    @keyframes pulse { 0%{opacity:0.4} 50%{opacity:1} 100%{opacity:0.4} }
    .muted{ color:var(--muted) }
    input[type=file]{ display:none }

    /* Mic level meter */
    .meterWrap{ display:flex; align-items:center; gap:6px; }
    .meter{
      width:140px; height:10px; border-radius:999px; background:#0d1530; border:1px solid #203063; overflow:hidden;
    }
    .meter .fill{ height:100%; width:0%; background:linear-gradient(90deg, #5aa3ff, #a076ff); }

    .layout{
      max-width:1600px; margin:0 auto; padding:16px; display:grid; gap:16px;
      grid-template-columns: 1fr 1fr;
      height: calc(100dvh - 72px);
    }
    .panel{
      background:linear-gradient(180deg, #0f1733, #0b1229);
      border:1px solid #1a2550;
      border-radius:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      overflow:hidden;
      display:flex; flex-direction:column;
    }
    .head{ padding:10px 14px; border-bottom:1px solid #192046; display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .head h2{ margin:0; font-size:16px; color:var(--muted) }
    .body{ flex:1; overflow:auto; }

    /* LEFT: sentence editable buttons */
    .sentList{ padding:14px; display:flex; flex-direction:column; gap:8px; }
    .sentItem{ display:flex; align-items:center; gap:8px; }
    .num{ min-width:48px; text-align:right; color:var(--muted); font-size:12px; }
    .sentBtn{
      flex:1;
      border-radius:12px; padding:10px 12px;
      background:#0d1530; border:1px solid #1a2550; color:var(--ink);
      font-size:15px;
      cursor:pointer;
      outline:none;
    }
    .sentBtn:focus{ outline:1px solid #2a3b75; }
    .sentBtn[contenteditable="true"]{ caret-color:#e8eeff; }
    .sentBtn.active{
      background:#12204a; border-color:#2a3b75;
      box-shadow: 0 0 0 2px rgba(42,59,117,0.35) inset;
    }

    /* RIGHT: current, next, next2 (same size) */
    .rightWrap{ padding:20px; display:flex; flex-direction:column; gap:12px; }
    .slot{
      white-space:pre-wrap; border-radius:14px; padding:20px 22px;
      background:#0d1530; border:2px solid #1a2550;
      font-size: clamp(24px, 4vw, 44px);
    }
    .slot.current{ border-color:#2a3b75; background:#12204a; }

  </style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="leftCtrls">
        <h1>🎚️ Sermon Cue Assist · v5.2</h1>
        <label class="pill">📄 원고 불러오기<input id="fileInput" type="file" accept=".txt,.md"/></label>
        <button class="pill" id="btnSample">샘플 원고</button>
      </div>
      <div class="rightCtrls">
        <!-- 마이크 장치 선택 -->
        <label class="pill">
          🎤 마이크
          <select id="micSelect" style="background:transparent;border:none;color:var(--ink);outline:none;max-width:180px">
            <option>Loading…</option>
          </select>
        </label>
        <div class="meterWrap">
          <span class="pill"><span class="dot" id="recDot"></span><span id="recState" class="muted">대기</span></span>
          <div class="meter"><div id="meterFill" class="fill"></div></div>
        </div>
        <button class="pill" id="btnStart">🎙️ 듣기 시작</button>
        <button class="pill" id="btnStop">⏹️ 듣기 중지</button>
        <!-- 낭독 제어 -->
        <label class="pill">
          🔊 낭독 음성
          <select id="voiceSelect" style="background:transparent;border:none;color:var(--ink);outline:none;max-width:220px">
            <option>로딩 중…</option>
          </select>
        </label>
        <label class="pill" title="낭독 속도">
          ⏩ 속도
          <input id="rateRange" type="range" min="0.5" max="1.4" step="0.1" value="1.0" style="width:120px">
          <span id="rateVal" class="muted">1.0x</span>
        </label>
        <button class="pill" id="btnSpeakCurrent">🗣️ 현재문장</button>
        <button class="pill" id="btnSpeakAll">📖 전체낭독</button>
        <button class="pill" id="btnTtsPause">⏸️ 일시정지</button>
        <button class="pill" id="btnTtsResume">▶️ 재개</button>
        <button class="pill" id="btnTtsStop">⏹️ 정지</button>
      </div>
    </div>
  </header>

  <main class="layout">
    <!-- LEFT -->
    <section class="panel">
      <div class="head"><h2>문장 버튼 (편집 가능)</h2><div class="muted">포커스/더블클릭으로 편집</div></div>
      <div class="body">
        <div id="sentList" class="sentList"></div>
      </div>
    </section>

    <!-- RIGHT -->
    <section class="panel">
      <div class="head"><h2>현재 → 다음 → 다음</h2><div class="muted">Space 시작/정지 · ↑/↓ 이동</div></div>
      <div class="body">
        <div class="rightWrap">
          <div class="slot current" id="currSent">원고를 불러오세요.</div>
          <div class="slot" id="nextSent">—</div>
          <div class="slot" id="next2Sent">—</div>
        </div>
      </div>
    </section>
  </main>

  <script src="lib/fuse.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
